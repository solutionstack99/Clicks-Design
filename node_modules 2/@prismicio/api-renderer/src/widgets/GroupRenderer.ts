import type { GroupContent } from "@prismicio/types-internal/lib/content"
import type { Group as GroupField } from "@prismicio/types-internal/lib/customtypes"

import type { Renderer } from "../models"
import type { Group as GroupFetch } from "../models/fetch"
import type RenderContext from "../models/RenderContext"
import SimpleWidgetRenderer from "./SimpleWidgetRenderer"

const GroupRenderer: (ctx: RenderContext) => Renderer<GroupField, GroupContent, GroupFetch> = (ctx) => ({
	renderV1(content: GroupContent, fetch?: GroupFetch | undefined): unknown {
		return {
			type: "Group",
			value: content.value.map((items) => {
				return SimpleWidgetRenderer(ctx).renderObjectOfSimpleWidgetV1(items.value, fetch?.fields)
			}),
		}
	},

	renderV2(groupDef: GroupField, content: GroupContent, fetch?: GroupFetch | undefined): unknown {
		return content.value.map((items) => {
			return SimpleWidgetRenderer(ctx).renderObjectOfSimpleWidgetV2(
				items.value,
				fetch?.fields,
				groupDef.config?.fields || {},
				{
					withFetch: "filter",
				},
				{
					default: "default",
					withFetch: "default",
					withFetchField: "default",
				},
			)
		})
	},

	renderDefault(_: GroupField): unknown {
		return []
	},

	renderMocks(def: GroupField, content: GroupContent) {
		return content.value.map((items) => {
			if (!def.config?.fields) return {}
			return SimpleWidgetRenderer(ctx).renderObjectOfSimpleWidgetMocks(items.value, def.config?.fields)
		})
	},
})

export default GroupRenderer
